
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymchelper.flair.common.bmath &#8212; pymchelper 1.10.0+rev3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymchelper 1.10.0+rev3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymchelper.flair.common.bmath</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymchelper.flair.common.bmath</h1><div class="highlight"><pre>
<span></span><span class="c1"># $Id: bmath.py 3739 2016-03-22 08:14:24Z bnv $</span>
<span class="c1">#</span>
<span class="c1"># Copyright and User License</span>
<span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="c1"># Copyright Vasilis.Vlachoudis@cern.ch for the</span>
<span class="c1"># European Organization for Nuclear Research (CERN)</span>
<span class="c1">#</span>
<span class="c1"># All rights not expressly granted under this license are reserved.</span>
<span class="c1">#</span>
<span class="c1"># Installation, use, reproduction, display of the</span>
<span class="c1"># software (&quot;flair&quot;), in source and binary forms, are</span>
<span class="c1"># permitted free of charge on a non-exclusive basis for</span>
<span class="c1"># internal scientific, non-commercial and non-weapon-related</span>
<span class="c1"># use by non-profit organizations only.</span>
<span class="c1">#</span>
<span class="c1"># For commercial use of the software, please contact the main</span>
<span class="c1"># author Vasilis.Vlachoudis@cern.ch for further information.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following</span>
<span class="c1"># conditions are met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright</span>
<span class="c1">#    notice, this list of conditions and the following disclaimer.</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#    notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#    documentation and/or other materials provided with the</span>
<span class="c1">#    distribution.</span>
<span class="c1">#</span>
<span class="c1"># DISCLAIMER</span>
<span class="c1"># ~~~~~~~~~~</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT</span>
<span class="c1"># NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY, OF</span>
<span class="c1"># SATISFACTORY QUALITY, AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># OR USE ARE DISCLAIMED. THE COPYRIGHT HOLDERS AND THE</span>
<span class="c1"># AUTHORS MAKE NO REPRESENTATION THAT THE SOFTWARE AND</span>
<span class="c1"># MODIFICATIONS THEREOF, WILL NOT INFRINGE ANY PATENT,</span>
<span class="c1"># COPYRIGHT, TRADE SECRET OR OTHER PROPRIETARY RIGHT.</span>
<span class="c1">#</span>
<span class="c1"># LIMITATION OF LIABILITY</span>
<span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="c1"># THE COPYRIGHT HOLDERS AND THE AUTHORS SHALL HAVE NO</span>
<span class="c1"># LIABILITY FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL,</span>
<span class="c1"># CONSEQUENTIAL, EXEMPLARY, OR PUNITIVE DAMAGES OF ANY</span>
<span class="c1"># CHARACTER INCLUDING, WITHOUT LIMITATION, PROCUREMENT OF</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES, LOSS OF USE, DATA OR PROFITS,</span>
<span class="c1"># OR BUSINESS INTERRUPTION, HOWEVER CAUSED AND ON ANY THEORY</span>
<span class="c1"># OF CONTRACT, WARRANTY, TORT (INCLUDING NEGLIGENCE), PRODUCT</span>
<span class="c1"># LIABILITY OR OTHERWISE, ARISING IN ANY WAY OUT OF THE USE OF</span>
<span class="c1"># THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>

<span class="c1"># Author:	Vasilis.Vlachoudis@cern.ch</span>
<span class="c1"># Date:	15-May-2004</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">generators</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">pymchelper.flair.common.rexx</span> <span class="k">as</span> <span class="nn">rexx</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Vasilis Vlachoudis&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;Vasilis.Vlachoudis@cern.ch&quot;</span>

<span class="c1"># Accuracy for comparison operators</span>
<span class="n">_accuracy</span> <span class="o">=</span> <span class="mf">1E-15</span>

<span class="c1"># Formating</span>
<span class="n">_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%12g</span><span class="s2">&quot;</span>


<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Cmp0"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Cmp0">[docs]</a><span class="k">def</span> <span class="nf">Cmp0</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_accuracy</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># range of floating point numbers</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="frange"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.frange">[docs]</a><span class="k">def</span> <span class="nf">frange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;range(start,stop,step) for floating point numbers&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">x</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">step</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">x</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">step</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># limit in number within a range</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="limit"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.limit">[docs]</a><span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">max_</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    limit a number within a specific range</span>
<span class="sd">    :param min_:</span>
<span class="sd">    :param num:</span>
<span class="sd">    :param max_:</span>
<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">max_</span><span class="p">),</span> <span class="n">min_</span><span class="p">)</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># dms - degrees from degrees, minutes, seconds</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="dms"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.dms">[docs]</a><span class="k">def</span> <span class="nf">dms</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">d</span> <span class="o">+</span> <span class="n">m</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="mf">3600.0</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># d2s - degrees to string</span>
<span class="c1"># D2S(angle[,&quot;H&quot;|&quot;M&quot;|&quot;D&quot;|&quot;N&quot;])</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="d2s"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.d2s">[docs]</a><span class="k">def</span> <span class="nf">d2s</span><span class="p">(</span><span class="n">ang</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ang</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="o">-</span><span class="n">ang</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">ang</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ang</span> <span class="o">*</span> <span class="mi">360000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">SS</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%05.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">ang</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ang</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span>
    <span class="n">MM</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ang</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">HH</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ang</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HH</span> <span class="o">+</span> <span class="s2">&quot;h&quot;</span> <span class="o">+</span> <span class="n">MM</span> <span class="o">+</span> <span class="s2">&quot;m&quot;</span> <span class="o">+</span> <span class="n">SS</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HH</span> <span class="o">+</span> <span class="s2">&quot;h&quot;</span> <span class="o">+</span> <span class="n">MM</span> <span class="o">+</span> <span class="s2">&quot;m&quot;</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HH</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">MM</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">SS</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HH</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">MM</span>
    <span class="k">return</span> <span class="n">HH</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">MM</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">SS</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Format a number to fit in the minimum space</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="format_number"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.format_number">[docs]</a><span class="k">def</span> <span class="nf">format_number</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">useExp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">useD</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format a number to fit in the minimum space given by length</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_MAXLEN</span> <span class="o">=</span> <span class="mi">22</span>

    <span class="c1"># Convert number to string</span>
    <span class="c1"># XXX str cuts at 12 digits, repr shows everything but</span>
    <span class="c1"># numbers like e.g 9.2 will be converted to 9.1999999999999</span>
    <span class="c1"># What should I do</span>
    <span class="c1"># Fields also in the CardWidget are converted with str and</span>
    <span class="c1"># are cut at 12 digits!!!!</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rexx</span><span class="o">.</span><span class="n">datatype</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">number</span>

    <span class="k">if</span> <span class="n">useD</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span>
        <span class="n">expE</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
        <span class="n">expE</span> <span class="o">=</span> <span class="s2">&quot;E&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
        <span class="n">hasExp</span> <span class="o">=</span> <span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">expE</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">useExp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hasExp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">number</span>
        <span class="k">elif</span> <span class="n">number</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">hasExp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">number</span>

    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">useExp</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0.</span><span class="si">%s</span><span class="s2">0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0.0&quot;</span>

    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">_MAXLEN</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Format invalid length&quot;</span><span class="p">)</span>

    <span class="c1"># Dissect the number. It is in the normal Rexx format.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">mantissa</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exponent</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">exponent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exponent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">mantissa</span> <span class="o">=</span> <span class="n">number</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">mantissa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">sgn</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mantissa</span> <span class="o">=</span> <span class="n">mantissa</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">mantissa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
        <span class="n">sgn</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mantissa</span> <span class="o">=</span> <span class="n">mantissa</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sgn</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">befo</span><span class="p">,</span> <span class="n">afte</span><span class="p">)</span> <span class="o">=</span> <span class="n">mantissa</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">befo</span> <span class="o">=</span> <span class="n">mantissa</span>
        <span class="n">afte</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Count from the left for the decimal point.</span>
    <span class="n">point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">befo</span><span class="p">)</span>

    <span class="c1"># Make this a number without a point.</span>
    <span class="n">integer</span> <span class="o">=</span> <span class="n">befo</span> <span class="o">+</span> <span class="n">afte</span>

    <span class="c1"># Remove leading zeros</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">integer</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="n">p</span><span class="p">:]</span>
                <span class="n">point</span> <span class="o">-=</span> <span class="n">p</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">useExp</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0.</span><span class="si">%s</span><span class="s2">0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0.0&quot;</span>

    <span class="c1"># ... and trailing</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">integer</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">break</span>

    <span class="n">exponent</span> <span class="o">+=</span> <span class="n">point</span>

    <span class="c1"># Cannot handle more than _MAXLEN digits</span>
    <span class="n">lint</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lint</span> <span class="o">&gt;</span> <span class="n">_MAXLEN</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="n">_MAXLEN</span><span class="p">]</span>
        <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">_MAXLEN</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lint</span><span class="p">:</span>
                <span class="n">exponent</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_MAXLEN</span><span class="p">:</span>
                    <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">_MAXLEN</span><span class="p">]</span>

    <span class="c1"># Now the number is described by:</span>
    <span class="c1">#   sgn 0.integer &quot;E&quot; exponent</span>

    <span class="c1"># Make space for sign</span>
    <span class="k">if</span> <span class="n">sgn</span><span class="p">:</span>
        <span class="n">length</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Minimum length representation of a number</span>
        <span class="c1"># Length = Length of integer</span>
        <span class="c1">#       + 1 for Dot if needed (no exponent)</span>
        <span class="c1">#       + (2-4) for exponent</span>
        <span class="c1">#  exponent can be in the following forms</span>
        <span class="c1">#       nothing if dot can placed inside integer</span>
        <span class="c1">#       E# 2</span>
        <span class="c1">#       E## 3</span>
        <span class="c1">#       E-# 3</span>
        <span class="c1">#       E-## 4</span>
        <span class="c1">#   integer is given as  0.integer</span>
        <span class="c1"># say(&quot;\ninteger=&quot;,integer,len(integer),length)</span>
        <span class="c1"># say(&quot;exponent=&quot;,exponent)</span>
        <span class="n">lint</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">useExp</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rexx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">expE</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;.00</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;.0</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="n">rexx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">lint</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">exponent</span> <span class="o">&lt;=</span> <span class="n">lint</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="n">rexx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">exponent</span> <span class="o">&lt;=</span> <span class="n">lint</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="n">lint</span><span class="p">:</span>
                <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">exponent</span> <span class="o">-</span> <span class="n">lint</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">exponent</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="n">lint</span> <span class="ow">and</span> <span class="n">exponent</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">exponent</span> <span class="o">-</span> <span class="n">lint</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rexx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">expE</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mNum</span><span class="p">)</span> <span class="o">-</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="o">-</span><span class="n">diff</span><span class="p">]</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">diff</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
            <span class="n">lint</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">integer</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lint</span><span class="p">:</span>
                <span class="n">exponent</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Remove trailing zeros</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">integer</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">useExp</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;0.</span><span class="si">%s</span><span class="s2">0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;0.0&quot;</span>

    <span class="k">if</span> <span class="n">sgn</span><span class="p">:</span>
        <span class="n">mNum</span> <span class="o">=</span> <span class="s2">&quot;-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mNum</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mNum</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Dangerous dictionary that unknown keys return a user default value</span>
<span class="c1"># Use it with care</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="DefaultDict"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.DefaultDict">[docs]</a><span class="k">class</span> <span class="nc">DefaultDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">)</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Unknown keys will return 0.0</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="ZeroDict"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.ZeroDict">[docs]</a><span class="k">class</span> <span class="nc">ZeroDict</span><span class="p">(</span><span class="n">DefaultDict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DefaultDict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Unknown keys will return 0.0</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="ZeroIntDict"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.ZeroIntDict">[docs]</a><span class="k">class</span> <span class="nc">ZeroIntDict</span><span class="p">(</span><span class="n">DefaultDict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DefaultDict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># ===============================================================================</span>
<span class="c1"># Vector class</span>
<span class="c1"># Inherits from List</span>
<span class="c1"># ===============================================================================</span>
<div class="viewcode-block" id="Vector"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector">[docs]</a><span class="k">class</span> <span class="nc">Vector</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector class&quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new vector,</span>
<span class="sd">        Vector(size), Vector(list), Vector(x,y,z,...)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.set"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set vector&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">z</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="n">_format</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]))</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.eq"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.eq">[docs]</a>    <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test for equality with vector v within accuracy&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">s2</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">s2</span> <span class="o">&lt;=</span> <span class="n">acc</span><span class="o">**</span><span class="mi">2</span></div>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Negate vector&quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add 2 vectors&quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add vector v to self&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract 2 vectors&quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract vector v from self&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Scale or Dot product</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;scale*Vector() or Vector()*Vector() - Scale vector or dot product&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Scale or Dot product</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;scale*Vector() or Vector()*Vector() - Scale vector or dot product&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Divide by floating point</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">([</span><span class="n">x</span> <span class="o">/</span> <span class="n">b</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cross product&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.dot"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.dot">[docs]</a>    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dot product of 2 vectors&quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">s</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.cross"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.cross">[docs]</a>    <span class="k">def</span> <span class="nf">cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cross product of 2 vectors&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                          <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cross product needs 2d or 3d vectors&quot;</span><span class="p">)</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.length2"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.length2">[docs]</a>    <span class="k">def</span> <span class="nf">length2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return length squared of vector&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">s</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.length"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.length">[docs]</a>    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return length of vector&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

    <span class="fm">__abs__</span> <span class="o">=</span> <span class="n">length</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.arg"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.arg">[docs]</a>    <span class="k">def</span> <span class="nf">arg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return vector angle&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.norm"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.norm">[docs]</a>    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Normalize vector and return length&quot;&quot;&quot;</span>
        <span class="n">s_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s_length</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">invlen</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">s_length</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">invlen</span>
        <span class="k">return</span> <span class="n">s_length</span></div>

    <span class="n">normalize</span> <span class="o">=</span> <span class="n">norm</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.unit"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.unit">[docs]</a>    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a unit vector&quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">v</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.clone"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clone vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.x"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.x">[docs]</a>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Vector.y"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.y">[docs]</a>    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Vector.z"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.z">[docs]</a>    <span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.orthogonal"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.orthogonal">[docs]</a>    <span class="k">def</span> <span class="nf">orthogonal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a vector orthogonal to self&quot;&quot;&quot;</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">xx</span> <span class="o">&lt;</span> <span class="n">yy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">&lt;</span> <span class="n">zz</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yy</span> <span class="o">&lt;</span> <span class="n">zz</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.direction"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.direction">[docs]</a>    <span class="k">def</span> <span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return containing the direction</span>
<span class="sd">        if normalized with any of the axis&quot;&quot;&quot;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;O&quot;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;X&quot;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;-X&quot;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Y&quot;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;-Y&quot;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Z&quot;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;-Z&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># nothing special about the direction, return N</span>
            <span class="k">return</span> <span class="s2">&quot;N&quot;</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Set the vector directly in polar coordinates</span>
    <span class="c1"># @param ma magnitude of vector</span>
    <span class="c1"># @param ph azimuthal angle in radians</span>
    <span class="c1"># @param th polar angle in radians</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.setPolar"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.setPolar">[docs]</a>    <span class="k">def</span> <span class="nf">setPolar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">th</span><span class="p">):</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span> <span class="o">*</span> <span class="n">st</span> <span class="o">*</span> <span class="n">cf</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span> <span class="o">*</span> <span class="n">st</span> <span class="o">*</span> <span class="n">sf</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span> <span class="o">*</span> <span class="n">ct</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># @return the azimuth angle.</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.phi"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.phi">[docs]</a>    <span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Cmp0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Cmp0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">()):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># @return the polar angle.</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.theta"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.theta">[docs]</a>    <span class="k">def</span> <span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Cmp0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Cmp0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Cmp0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">()):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">())</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># @return cosine of the polar angle.</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.cosTheta"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.cosTheta">[docs]</a>    <span class="k">def</span> <span class="nf">cosTheta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ptot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Cmp0</span><span class="p">(</span><span class="n">ptot</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">()</span> <span class="o">/</span> <span class="n">ptot</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># @return the transverse component squared</span>
    <span class="c1">#   (R^2 in cylindrical coordinate system).</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.perp2"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.perp2">[docs]</a>    <span class="k">def</span> <span class="nf">perp2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">()</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># @return the transverse component</span>
    <span class="c1"># (R in cylindrical coordinate system).</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Vector.perp"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Vector.perp">[docs]</a>    <span class="k">def</span> <span class="nf">perp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perp2</span><span class="p">())</span></div></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Basic 3D Vectors</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="n">Vector</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># noqa: E741</span>
<span class="n">Vector</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">Vector</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">Vector</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Return a random 3D vector</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="random3D"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.random3D">[docs]</a><span class="k">def</span> <span class="nf">random3D</span><span class="p">():</span>
    <span class="n">cosTheta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">sinTheta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cosTheta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sinTheta</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sinTheta</span><span class="p">,</span> <span class="n">cosTheta</span><span class="p">)</span></div>


<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Return a random nolor</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="rndColor"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.rndColor">[docs]</a><span class="k">def</span> <span class="nf">rndColor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">rnd</span><span class="p">(</span><span class="n">zw</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">zw</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">zw</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mi">36969</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">18000</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">224</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">224</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">224</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span>
    <span class="k">return</span> <span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">G</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">B</span></div>


<span class="c1"># ===============================================================================</span>
<span class="c1"># Matrix class</span>
<span class="c1"># Use 4x4 matrix for vector transformations</span>
<span class="c1"># ===============================================================================</span>
<div class="viewcode-block" id="Matrix"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix">[docs]</a><span class="k">class</span> <span class="nc">Matrix</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Matrix 4x4 used for vector transformations&quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cols</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matrix(rows=4, cols=-1, type=0|1)</span>
<span class="sd">        if rows is integer then</span>
<span class="sd">            Create a matrix rows x cols either</span>
<span class="sd">            zero(type=0) or unary(type=1)</span>
<span class="sd">        elif rows is a list of lists</span>
<span class="sd">            create a matrix from a double-list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">([[]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not a valid double-list for a matrix&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rows</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Array size too small&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cols</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="bp">self</span> <span class="o">+=</span> <span class="p">[[]]</span> <span class="o">*</span> <span class="n">rows</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unary</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Create a diagonal square matrix from a list</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.diagonal"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.diagonal">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">diagonal</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># append row</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.append"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.translate"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.translate">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;m = Matrix.translate(x,y,z|vector)</span>
<span class="sd">        @return a translation matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.scale"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.scale">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sz</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;m = Matrix.scale(scale|vector)</span>
<span class="sd">           @return a scaling matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">sx</span>
        <span class="k">if</span> <span class="n">sz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">sx</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span>
            <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.zero"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.zero">[docs]</a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Zero matrix&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.unary"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.unary">[docs]</a>    <span class="k">def</span> <span class="nf">unary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unary matrix&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Create a transformation matrix from 3 normalized vectors</span>
    <span class="c1"># and optionally a translation</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.make"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.make">[docs]</a>    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a transformation matrix from 3 normalized vectors&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unary</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">^</span> <span class="n">Y</span>
                <span class="n">Z</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Matrix.make() works only &quot;</span> <span class="s2">&quot;on Matrix(3x3) or Matrix(4x4)&quot;</span><span class="p">)</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiline string representation of matrix&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">last</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">first</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">_format</span> <span class="o">%</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.writeOctave"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.writeOctave">[docs]</a>    <span class="k">def</span> <span class="nf">writeOctave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write an octave matrix file&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# bmath.Matrix</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# type: matrix</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# rows: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# columns: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.T"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.T">[docs]</a>    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;@return transpose matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">m</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="n">transpose</span> <span class="o">=</span> <span class="n">T</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.trace"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return trace of matrix (sum of diagonal elements)&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">t</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test for equality of 2 matrices&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">!=</span> <span class="n">m</span><span class="o">.</span><span class="n">rows</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">!=</span> <span class="n">m</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Create a rotation matrix around one axis</span>
    <span class="c1">#   X = 0</span>
    <span class="c1">#   Y = 1</span>
    <span class="c1">#   Z = 2</span>
    <span class="c1"># or an arbitrary vector</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.rotate"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add rotation elements to the matrix around one axis</span>
<span class="sd">        Axis X=0, Y=1, Z=2, or an arbitrary one given by vector axis&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unary</span><span class="p">()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="p">((</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">m1</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">m1</span><span class="p">][</span><span class="n">m1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">m2</span><span class="p">][</span><span class="n">m2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">m1</span><span class="p">][</span><span class="n">m2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">m2</span><span class="p">][</span><span class="n">m1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">length</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">length</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">length</span>

            <span class="n">c1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">c</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">s</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span>

            <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">s</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">s</span>

            <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">s</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.rotX"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.rotX">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rotX</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;m = Matrix.rotX(angle) - Return a rotation matrix around X&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.rotY"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.rotY">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rotY</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;m = Matrix.rotY(angle) - Return a rotation matrix arround Y&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.rotZ"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.rotZ">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rotZ</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;m = Matrix.rotZ(angle) - Return a rotation matrix arround Z&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.getEulerRotation"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.getEulerRotation">[docs]</a>    <span class="k">def</span> <span class="nf">getEulerRotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ROTX(x) * ROTY(y) * ROTZ(z)</span>
        <span class="c1">#  cos(z)*cos(y)</span>
        <span class="c1">#  sin(z)*cos(y)</span>
        <span class="c1">#        -sin(y)</span>
        <span class="c1"># -sin(z)*cos(x)+cos(z)*sin(y)*sin(x)</span>
        <span class="c1">#  cos(z)*cos(x)+sin(z)*sin(y)*sin(x)</span>
        <span class="c1">#                       cos(y)*sin(x)</span>
        <span class="c1">#  sin(z)*sin(x)+cos(z)*sin(y)*cos(x)</span>
        <span class="c1"># -cos(z)*sin(x)+sin(z)*sin(y)*cos(x)</span>
        <span class="c1">#                       cos(y)*cos(x)</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ry</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">rz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.eulerRotation"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.eulerRotation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">eulerRotation</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">):</span>
        <span class="c1"># ROTX(x) * ROTY(y) * ROTZ(z)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">cy</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">cy</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sz</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sx</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">+</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cz</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cx</span>

        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add 2 matrices&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">rows</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Matrix.add: matrices same size&quot;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">mrow</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">arow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">brow</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">mrow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">arow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">brow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract 2 matrices&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">rows</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Matrix.add: matrices same size&quot;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">mrow</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">arow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">brow</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">mrow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">arow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">brow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Negate matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">mrow</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mold</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">mrow</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mold</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply two matrices or vector</span>
<span class="sd">           A.__mul__(B|vec) &lt;==&gt; A*B or A*vec&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">):</span>  <span class="c1"># has to be a matrix of same cxN * Nxr</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">!=</span> <span class="n">B</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;arrays don&#39;t have the correct dimensions&quot;</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="k">return</span> <span class="n">r</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># Vector or list</span>
            <span class="n">vecsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">vecsize</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vecsize</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">vecsize</span><span class="p">)):</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vecsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">B</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
    <span class="c1"># Special function to multiply a transformation matrix with a vector</span>
    <span class="c1"># ignoring the translation</span>
    <span class="c1"># -----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.multNoTranslation"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.multNoTranslation">[docs]</a>    <span class="k">def</span> <span class="nf">multNoTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply matrix with a vector ignoring the translation part&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid operation&quot;</span><span class="p">)</span>
        <span class="n">vecsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">vecsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vecsize</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">vecsize</span><span class="p">)):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">v</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.inv"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.inv">[docs]</a>    <span class="k">def</span> <span class="nf">inv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inverse matrix in place&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;inverting a non square matrix&quot;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ludcmp</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
            <span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lubksb</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
                <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></div>

    <span class="n">inverse</span> <span class="o">=</span> <span class="n">inv</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.clone"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clone matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># determinant with Gauss method</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Matrix.det"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Matrix.det">[docs]</a>    <span class="k">def</span> <span class="nf">det</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;determinant of square matrix using Gauss method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> \
                <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">rows</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># find the absolute maximum value</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">ma</span><span class="p">:</span>
                    <span class="n">ma</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">ma</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>

            <span class="c1"># swap rows i,k</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>  <span class="c1"># Change sign of determinate</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

            <span class="c1"># make all the following rows with zero at the i column</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">_accuracy</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">s</span> <span class="o">*=</span> <span class="n">d</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">*=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span></div>

    <span class="n">determinant</span> <span class="o">=</span> <span class="n">det</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># LU decomposition.</span>
    <span class="c1"># Parameters</span>
    <span class="c1">#      index[0:size]	row permutation record</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__ludcmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>  <span class="c1"># procedure expose indx.</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">big</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">big</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span> <span class="n">big</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">big</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Singular matrix found&quot;</span><span class="p">)</span>
            <span class="n">vv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">big</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">-=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

            <span class="n">big</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">-=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

                <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
                <span class="n">dum</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dum</span> <span class="o">&gt;=</span> <span class="n">big</span><span class="p">:</span>
                    <span class="n">big</span> <span class="o">=</span> <span class="n">dum</span>
                    <span class="n">imax</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">imax</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                    <span class="n">dum</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">imax</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">imax</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">dum</span>
                <span class="n">vv</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">imax</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1E-20</span>

            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dum</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dum</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># backward substitution</span>
    <span class="c1">#      index[0:size]	  row permutation record</span>
    <span class="c1">#      col[0:size]	  right hand vector (?)</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__lubksb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
            <span class="n">col</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">-=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">s</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">-=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Basic Matrices</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="n">Matrix</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># noqa: E741</span>
<span class="n">Matrix</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Quaternion</span>
<span class="c1">#</span>
<span class="c1"># Note: See the following for more information on quaternions:</span>
<span class="c1">#</span>
<span class="c1"># - Shoemake, K., Animating rotation with quaternion curves, Computer</span>
<span class="c1">#   Graphics 19, No 3 (Proc. SIGGRAPH&#39;85), 245-254, 1985.</span>
<span class="c1"># - Pletinckx, D., Quaternion calculus as a basic tool in computer</span>
<span class="c1">#   graphics, The Visual Computer 5, 2-13, 1989.</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Quaternion"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Quaternion">[docs]</a><span class="k">class</span> <span class="nc">Quaternion</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">):</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>  <span class="c1"># trace of matrix</span>
            <span class="k">if</span> <span class="n">tr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span>  <span class="c1"># S=4*qw</span>
                <span class="n">qw</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">S</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qz</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="c1"># S=4*qx</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.0</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">S</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qz</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qw</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="c1"># S=4*qy</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.0</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">S</span>
                <span class="n">qz</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qw</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># S=4*qz</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.0</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
                <span class="n">qz</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">S</span>
                <span class="n">qw</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">S</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">])</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Vector</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Quaternions always obey:  a^2 + b^2 + c^2 + d^2 = 1.0</span>
    <span class="c1"># If they don&#39;t add up to 1.0, dividing by their magnitued will</span>
    <span class="c1"># renormalize them.</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Quaternion.norm"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Quaternion.norm">[docs]</a>    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;normalize quaternion&quot;&quot;&quot;</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">mag</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">mag</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/=</span> <span class="n">mag</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/=</span> <span class="n">mag</span>
        <span class="k">return</span> <span class="n">mag</span></div>

    <span class="n">normalize</span> <span class="o">=</span> <span class="n">norm</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Quaternion.vector"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Quaternion.vector">[docs]</a>    <span class="k">def</span> <span class="nf">vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return vector of quaternion&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># return rotation matrix</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Quaternion.matrix"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.Quaternion.matrix">[docs]</a>    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return rotation matrix&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">m</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Given two rotations, e1 and e2, expressed as quaternion rotations,</span>
    <span class="c1"># figure out the equivalent single rotation and stuff it into dest.</span>
    <span class="c1"># This routine also normalizes the result every RENORMCOUNT times it is</span>
    <span class="c1"># called, to keep error from creeping in.</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
        <span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span>

        <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="gauss"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.gauss">[docs]</a><span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve A*X = B using the Gauss elimination method&quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>

    <span class="n">p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># select j&gt;=k so that</span>
        <span class="c1"># |A[p[j]][k]| / s[p[i]] &gt;= |A[p[i]][k]| / s[p[i]] for i = k,k+1,...,n</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">api</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">api</span> <span class="o">&gt;</span> <span class="n">ap</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">ap</span> <span class="o">=</span> <span class="n">api</span>

        <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># Swap values</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">B</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">X</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="solveOverDetermined"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.solveOverDetermined">[docs]</a><span class="k">def</span> <span class="nf">solveOverDetermined</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve the overdetermined linear system defined by the matrices A,B</span>
<span class="sd">        such as A*X = B</span>
<span class="sd">    Optionally a weight can be specified&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">rows</span> <span class="o">&lt;</span> <span class="n">A</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;solveOverDetermined: &quot;</span> <span class="s2">&quot;A matrix has more columns than rows&quot;</span><span class="p">)</span>
    <span class="n">AT</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">W</span><span class="p">:</span>
        <span class="n">Wd</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">ATA</span> <span class="o">=</span> <span class="n">AT</span> <span class="o">*</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">A</span>
        <span class="n">ATB</span> <span class="o">=</span> <span class="n">AT</span> <span class="o">*</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">B</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ATA</span> <span class="o">=</span> <span class="n">AT</span> <span class="o">*</span> <span class="n">A</span>
        <span class="n">ATB</span> <span class="o">=</span> <span class="n">AT</span> <span class="o">*</span> <span class="n">B</span>
    <span class="n">ATA</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span>
    <span class="n">RT</span> <span class="o">=</span> <span class="n">ATA</span> <span class="o">*</span> <span class="n">ATB</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RT</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RT</span><span class="p">))]</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="linear"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.linear">[docs]</a><span class="k">def</span> <span class="nf">linear</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve linear regression y = ax + b</span>
<span class="sd">    @return a,b,r</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Sx</span> <span class="o">=</span> <span class="n">Sy</span> <span class="o">=</span> <span class="n">Sx2</span> <span class="o">=</span> <span class="n">Sy2</span> <span class="o">=</span> <span class="n">Sxy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
        <span class="n">Sx</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="n">Sy</span> <span class="o">+=</span> <span class="n">y</span>
        <span class="n">Sx2</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">Sy2</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">Sxy</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sxy</span> <span class="o">-</span> <span class="n">Sx</span> <span class="o">*</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Sx2</span> <span class="o">-</span> <span class="n">Sx</span> <span class="o">*</span> <span class="n">Sx</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">Sx</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sxy</span> <span class="o">-</span> <span class="n">Sx</span> <span class="o">*</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Sx2</span> <span class="o">-</span> <span class="n">Sx</span> <span class="o">*</span> <span class="n">Sx</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> \
            <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Sy2</span> <span class="o">-</span> <span class="n">Sy</span> <span class="o">*</span> <span class="n">Sy</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span>

    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1">#   Idiotimes pragmatikwv symmetrikwv pivakwv</span>
<span class="c1">#</span>
<span class="c1">#   O algori8mos poy xrnsimopoieitai stnv roytiva eivai gvwstos sav</span>
<span class="c1">#   proseggistikn me8odos Jacobi.</span>
<span class="c1">#   O algori8mos ekmetaleyetai tnv idiotnta poy exoyv oi diagwvioi</span>
<span class="c1">#   pivakes, dnladn pivakes me mndevika ola ta stoixeia ektos tns</span>
<span class="c1">#   kyrias diagwvioy, va exoyv sav idiotimes ta diagwvia stoixeia.</span>
<span class="c1">#   Me tov metasxnmatismo.</span>
<span class="c1">#         T                       T</span>
<span class="c1">#      A1 = R1 (f) A R1(f),    A2 = R2 (f) A1 R2(f)</span>
<span class="c1">#   metaballoyme syvexws tov pivaka A, mexris otoy to a8roisma olwv</span>
<span class="c1">#   twv mn diagwviwv stoixeiwv f8asei mia ka8orismevn timn tns eklogns</span>
<span class="c1">#   toy xrnstn n givei mndev</span>
<span class="c1">#   Ta bnmata tns diadikasias eivai:</span>
<span class="c1">#   1. Avazntnsn toy apolytws megistoy mn diagwvioy stoixeioy</span>
<span class="c1">#      Divei ta p kai q</span>
<span class="c1">#   2. Prosdiorismos tns gwvias peristrofns f. Divei ta sinf kai cosf</span>
<span class="c1">#   3. Metasxnmatismos Ai -&gt; Ai+1</span>
<span class="c1">#   4. Elegxos av to a8roisma twv mn diagwviwv stoixeiwv exei f8asei tnv</span>
<span class="c1">#      epi8ymntn timn. Eav vai tote ta diagwvia stoixeia eivai oi</span>
<span class="c1">#      proseggiseis twv idiotimwv, eav oxi tote epistrefoyme sto 1.</span>
<span class="c1">#      px.     |  1 -2 -1 |</span>
<span class="c1">#          A = | -2  1 -1 |</span>
<span class="c1">#              | -1 -1 2.5|</span>
<span class="c1">#      apolyto megisto A(1,2) = -2</span>
<span class="c1">#      Ypologizoyme tnv gwvia f, co=cos(f), si=sin(f) kai kavoyme tov</span>
<span class="c1">#      metasxnmatismo</span>
<span class="c1">#          | co -si  0 |   |  1 -2 -1 |   |  co  si  0 |</span>
<span class="c1">#      A = | si  co  0 | x | -2  1 -1 | x | -si  co  0 |</span>
<span class="c1">#          |  0   0  1 |   | -1 -1 2.5|   |   0   0  1 |</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#      Oi parametroi tns roytivas eivai oi e3ns:</span>
<span class="c1">#    A     - pivakas tetragwvikos</span>
<span class="c1">#    eps   - akribeia (a8roisma tetragwvwv)</span>
<span class="c1">#    check - av prepei va elejei tnv symmetria toy arxikoy pivaka</span>
<span class="c1">#        n oxi</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="eigenvalues"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.eigenvalues">[docs]</a><span class="k">def</span> <span class="nf">eigenvalues</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return eigen values and eigen vectors of a symmetric matrix&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">rows</span>

    <span class="c1"># elegxos av eivai symmetrikos o pivakas</span>
    <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">M</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Allocate arrays</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">RT</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ZW</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># kavovika 8a prepei meta apo merikes prospa8eies va tov aporiptei</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Bnma 1. Avazntnsn toy apolytws megistoy mn diagwvioy stoixeioy</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">el</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">el</span><span class="p">:</span>
                    <span class="n">el</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">el</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Ftiaxvei ta R, RT</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">RT</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span>

        <span class="c1"># Bnma 2. Prosdiorizei tnv gwvia f, cosf kai sinf</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">p</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">fi</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fi</span> <span class="o">*</span> <span class="n">fi</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span>
        <span class="n">co</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">R</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">co</span>
        <span class="n">RT</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">RT</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">co</span>

        <span class="n">R</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">si</span>
        <span class="n">R</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">si</span>
        <span class="n">RT</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">si</span>
        <span class="n">RT</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">si</span>

        <span class="c1"># Bnma 3. metasxnmatismos Ai+1 = Rt * Ai * R</span>
        <span class="c1">#  ka8os kai to ginomeno Rn*...*R2*R1 that</span>
        <span class="c1">#  gives us the eigenvectors</span>
        <span class="k">if</span> <span class="n">V</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="n">R</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
                    <span class="n">ZW</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zw1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                        <span class="n">zw1</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">ZW</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">zw1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
                    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZW</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zw1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                        <span class="n">zw1</span> <span class="o">+=</span> <span class="n">RT</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">ZW</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">zw1</span>

        <span class="c1"># Bnma 4. Briskoymai to a8roisma kai elegxoyme av teleiwse</span>
        <span class="n">zw1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">zw1</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">zw1</span> <span class="o">/=</span> <span class="n">n</span>

        <span class="c1"># Exit condition</span>
        <span class="k">if</span> <span class="n">zw1</span> <span class="o">&lt;=</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="p">([</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">())</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Given a function, and given a bracketing triplet of abscissas ax,bx,cx (such</span>
<span class="c1"># that bx is between ax and cx, and f(bx) is less than both f(ax) and f(cx),</span>
<span class="c1"># this routing performs a golden section search for the minimum, isolating it</span>
<span class="c1"># to a fractional precision of about eps. The abscissa of the minimum is</span>
<span class="c1"># returned as xmin, and the minimum function value is returned as golden, the</span>
<span class="c1"># returned function value.</span>
<span class="c1">#</span>
<span class="c1"># @param func	function to be evaluated</span>
<span class="c1"># @param ax	triplet of abscissas ax,bx,cx</span>
<span class="c1"># @param bx	where func(x+bx*d) &lt; min[ func(x+ax*d), func(x+cx*d) ]</span>
<span class="c1"># @param cx	...</span>
<span class="c1"># @param x	starting vector/value</span>
<span class="c1"># @param d	direction vector/value</span>
<span class="c1"># @param eps	accuracy of search</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="goldenSectionSearch"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.goldenSectionSearch">[docs]</a><span class="k">def</span> <span class="nf">goldenSectionSearch</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">0.61803399</span>  <span class="c1"># The golden ratio</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">ax</span>  <span class="c1"># At any given time we will keep track of four points</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">cx</span>  <span class="c1"># x0, x1, x2, x3</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bx</span> <span class="o">-</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">bx</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">bx</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">bx</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">bx</span> <span class="o">-</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">bx</span> <span class="o">-</span> <span class="n">ax</span><span class="p">)</span>

    <span class="n">f1</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>  <span class="c1"># The initial function evaluation</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x2</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">f2</span> <span class="o">&lt;</span> <span class="n">f1</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x1</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">x3</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">f2</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">x0</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">f1</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">f1</span> <span class="o">&lt;</span> <span class="n">f2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x2</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Generators for calculating a) the permutations of a sequence and</span>
<span class="c1"># b) the combinations and selections of a number of elements from a</span>
<span class="c1"># sequence. Uses Python 2.2 generators.</span>
<span class="c1"># Similar solutions found also in comp.lang.python</span>
<span class="c1"># Keywords: generator, combination, permutation, selection</span>
<span class="c1">#</span>
<span class="c1"># See also: http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/105962</span>
<span class="c1"># See also: http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66463</span>
<span class="c1"># See also: http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66465</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="xcombinations"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.xcombinations">[docs]</a><span class="k">def</span> <span class="nf">xcombinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">xcombinations</span><span class="p">(</span><span class="n">items</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cc</span></div>


<div class="viewcode-block" id="xuniqueCombinations"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.xuniqueCombinations">[docs]</a><span class="k">def</span> <span class="nf">xuniqueCombinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">xuniqueCombinations</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cc</span></div>


<div class="viewcode-block" id="xselections"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.xselections">[docs]</a><span class="k">def</span> <span class="nf">xselections</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">xselections</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">ss</span></div>


<div class="viewcode-block" id="xpermutations"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.xpermutations">[docs]</a><span class="k">def</span> <span class="nf">xpermutations</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">xcombinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">))</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Conversion between rectangular and polar coordinates</span>
<span class="c1"># Usage:</span>
<span class="c1">#  real, real = rect(real, real [, deg=False])</span>
<span class="c1">#  real, real = polar(real, real [, deg=False])</span>
<span class="c1"># Normally, rect() and polar() uses radian for angle; but,</span>
<span class="c1"># if deg=True specified, degree is used instead.</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># radian if deg=False; degree if deg=True</span>
<div class="viewcode-block" id="rect"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.rect">[docs]</a><span class="k">def</span> <span class="nf">rect</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from polar (r,w) to rectangular (x,y)</span>
<span class="sd">        x = r cos(w)</span>
<span class="sd">        y = r sin(w)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># radian if deg=False; degree if deg=True</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="polar"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.polar">[docs]</a><span class="k">def</span> <span class="nf">polar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from rectangular (x,y) to polar (r,w)</span>
<span class="sd">        r = sqrt(x^2 + y^2)</span>
<span class="sd">        w = arctan(y/x) = [-pi,pi] = [-180,180]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="quadratic"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.quadratic">[docs]</a><span class="k">def</span> <span class="nf">quadratic</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># Always return this as a solution!!!</span>
        <span class="k">if</span> <span class="n">D</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">eps</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">bD</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bD</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">bD</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">bD</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Cubic equation: y^3 + a*y^2 + b*y + c = 0 (or ax^3 + bx^2 + cx + d = 0)</span>
<span class="c1">#</span>
<span class="c1"># Normally, x^3 + ax^2 + bx + c = 0 is assumed with the 3 coefficients as</span>
<span class="c1"># arguments; but, if 4 arguments are present, then ax^3 + bx^2 + cx + d = 0 is</span>
<span class="c1"># assumed.</span>
<span class="c1">#</span>
<span class="c1"># Even though both quadratic() and cubic() functions take real arguments, they</span>
<span class="c1"># can be modified to accept any real or complex coefficients because the method</span>
<span class="c1"># of solution does not make any assumptions.</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="cubic"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.cubic">[docs]</a><span class="k">def</span> <span class="nf">cubic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">_accuracy</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># (ax^3 + bx^2 + cx + d = 0)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">c</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">d</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mf">9.0</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">9.</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">27.</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">54.</span>

    <span class="n">R2</span> <span class="o">=</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Q3</span> <span class="o">=</span> <span class="n">Q</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">if</span> <span class="n">R2</span> <span class="o">&lt;</span> <span class="n">Q3</span><span class="p">:</span>  <span class="c1"># the cubic has 3 real solutions</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">R</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q3</span><span class="p">))</span>
        <span class="n">sqrt_Q</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sqrt_Q</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">3.</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sqrt_Q</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">theta</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">3.</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sqrt_Q</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">theta</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">3.</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span>

    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R2</span> <span class="o">-</span> <span class="n">Q3</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">/</span> <span class="n">A</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<span class="c1"># imaginary roots</span>
<span class="c1"># x2 = -(A+B)/2 - a/3 + i*sqrt(3)*(A-B)</span>
<span class="c1"># x3 = -(A+B)/2 - a/3 - i*sqrt(3)*(A-B)</span>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Fit a plane to a set of points using least square fitting</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="fitPlane"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.fitPlane">[docs]</a><span class="k">def</span> <span class="nf">fitPlane</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="c1"># First do statistics with points</span>
    <span class="n">Sx</span> <span class="o">=</span> <span class="n">Sy</span> <span class="o">=</span> <span class="n">Sz</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Sx2</span> <span class="o">=</span> <span class="n">Sy2</span> <span class="o">=</span> <span class="n">Sz2</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Sxy</span> <span class="o">=</span> <span class="n">Syz</span> <span class="o">=</span> <span class="n">Sxz</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">:</span>
        <span class="n">Sx</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="n">Sy</span> <span class="o">+=</span> <span class="n">y</span>
        <span class="n">Sz</span> <span class="o">+=</span> <span class="n">z</span>

        <span class="n">Sx2</span> <span class="o">+=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Sy2</span> <span class="o">+=</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Sz2</span> <span class="o">+=</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">Sxy</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">Syz</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
        <span class="n">Sxz</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">))</span>
    <span class="n">Sx</span> <span class="o">/=</span> <span class="n">n</span>
    <span class="n">Sy</span> <span class="o">/=</span> <span class="n">n</span>
    <span class="n">Sz</span> <span class="o">/=</span> <span class="n">n</span>
    <span class="n">Vx</span> <span class="o">=</span> <span class="n">Sx2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">Sx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Vy</span> <span class="o">=</span> <span class="n">Sy2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">Sy</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Vz</span> <span class="o">=</span> <span class="n">Sz2</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">Sz</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Count zero variances</span>
    <span class="n">nv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Vx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_accuracy</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Vy</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_accuracy</span><span class="p">)</span> <span class="o">+</span> \
        <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Vz</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_accuracy</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nv</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">nv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Planes parallel to axes</span>
        <span class="c1"># Try the solution of x=Xo or y=Yo or z=Zo</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_accuracy</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">Sx</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vy</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_accuracy</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">Sy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">Sz</span>

    <span class="c1"># Try a generic solution</span>
    <span class="c1">#  z = ax + by + d    &lt;=&gt;  ax + by -z + d = 0</span>
    <span class="c1">#  assuming c=-1</span>
    <span class="c1">#  it can only fail on ax + by + d = 0</span>
    <span class="c1">#</span>
    <span class="c1">#  / Sx2    Sxy    Sx \       / Sxz \</span>
    <span class="c1">#  | Sxy    Sy2    Sy | * X = | Syz |</span>
    <span class="c1">#  \ Sx     Sy     n  /       \ Sz  /</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">Sx2</span><span class="p">,</span> <span class="n">Sxy</span><span class="p">,</span> <span class="n">Sx</span><span class="p">],</span> <span class="p">[</span><span class="n">Sxy</span><span class="p">,</span> <span class="n">Sy2</span><span class="p">,</span> <span class="n">Sy</span><span class="p">],</span> <span class="p">[</span><span class="n">Sx</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">n</span><span class="p">]])</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">Sxz</span><span class="p">],</span> <span class="p">[</span><span class="n">Syz</span><span class="p">],</span> <span class="p">[</span><span class="n">Sz</span><span class="p">]])</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">A</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Try a solution where c=0</span>
    <span class="c1"># y = ax + d  &lt;=&gt;   ax -y +d = 0</span>
    <span class="c1"># .</span>
    <span class="c1">#  / Sx2    Sx \       / Sxy \</span>
    <span class="c1">#  |           | * X = |     |</span>
    <span class="c1">#  \ Sx     n  /       \ Sy  /</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">Sx2</span><span class="p">,</span> <span class="n">Sx</span><span class="p">],</span> <span class="p">[</span><span class="n">Sx</span><span class="p">,</span> <span class="n">n</span><span class="p">]])</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">Sxy</span><span class="p">],</span> <span class="p">[</span><span class="n">Sy</span><span class="p">]])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">A</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Evaluating n&#39;th degree polynomial is simple loop, starting with highest</span>
<span class="c1"># coefficient a[n].</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="polyeval"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.polyeval">[docs]</a><span class="k">def</span> <span class="nf">polyeval</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    p(x) = polyeval(a, x)</span>
<span class="sd">         = a[0] + a[1]x + a[2]x^2 +...+ a[n-1]x^{n-1} + a[n]x^n</span>
<span class="sd">         = a[0] + x(a[1] + x(a[2] +...+ x(a[n-1] + a[n]x)...)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">coef</span>
    <span class="n">a</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Find the first derivative of a polynomial</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="polyderiv"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.polyderiv">[docs]</a><span class="k">def</span> <span class="nf">polyderiv</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    p&#39;(x) = polyderiv(a)</span>
<span class="sd">          = b[0] + b[1]x + b[2]x^2 +...+ b[n-2]x^{n-2} + b[n-1]x^{n-1}</span>
<span class="sd">    where b[i] = (i+1)a[i+1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">b</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Factor out a root from n&#39;th degree polynomial, and return the remaining</span>
<span class="c1"># (n-1)&#39;th degree polynomial.</span>
<span class="c1"># list = polyreduce(list, number)</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="polyreduce"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.polyreduce">[docs]</a><span class="k">def</span> <span class="nf">polyreduce</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given x = r is a root of n&#39;th degree polynomial p(x) = (x-r)q(x),</span>
<span class="sd">    divide p(x) by linear factor (x-r) using the same algorithm as</span>
<span class="sd">    polynomial evaluation. Then, return the (n-1)&#39;th degree quotient</span>
<span class="sd">    q(x) = polyreduce(a, r)</span>
<span class="sd">         = c[0] + c[1]x + c[2]x^2 +...+ c[n-2]x^{n-2} + c[n-1]x^{n-1}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>
    <span class="n">a</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">root</span> <span class="o">+</span> <span class="n">coef</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Conversion from integer to Roman</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="int2roman"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.int2roman">[docs]</a><span class="k">def</span> <span class="nf">int2roman</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an integer to Roman numeral</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected integer, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">4000</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument must be between 1 and 3999&quot;</span><span class="p">)</span>

    <span class="n">ints</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;XC&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;IX&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span>
        <span class="n">num</span> <span class="o">-=</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">result</span></div>


<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Conversion from Roman to integer</span>
<span class="c1"># -------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="roman2int"><a class="viewcode-back" href="../../../../apidoc/pymchelper.flair.common.bmath.html#pymchelper.flair.common.bmath.roman2int">[docs]</a><span class="k">def</span> <span class="nf">roman2int</span><span class="p">(</span><span class="n">roman</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert a roman string to integer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">roman</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;expected string, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">roman</span><span class="p">))</span>
    <span class="n">roman</span> <span class="o">=</span> <span class="n">roman</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">places</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">roman</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;input is not a valid roman numeral: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roman</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roman</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">roman</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">nums</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
        <span class="c1"># If the next place holds a larger number, this value is negative.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nextvalue</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">nums</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">roman</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">nextvalue</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># there is no next place.</span>
            <span class="k">pass</span>
        <span class="n">places</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">places</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">n</span>

    <span class="c1"># Easiest test for validity...</span>
    <span class="k">if</span> <span class="n">int2roman</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">==</span> <span class="n">roman</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input is not a valid roman numeral: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">roman</span><span class="p">)</span></div>


<span class="c1"># ===============================================================================</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pymchelper.flair.common.log</span> <span class="k">import</span> <span class="n">say</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;-1e-</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">say</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)),</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">digits</span> <span class="o">=</span> <span class="s2">&quot;1234567890123456789012345678&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.123&quot;</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.1234567890&quot;</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.123&quot;</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">digits</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.1234567890&quot;</span>
        <span class="n">say</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02d</span><span class="s2"> </span><span class="si">%40s</span><span class="s2"> |</span><span class="si">%10s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">format_number</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>

    <span class="n">say</span><span class="p">(</span><span class="n">Vector</span><span class="o">.</span><span class="n">O</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">1.2345678901234567890</span>
    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e-05</span>
    <span class="n">say</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
    <span class="n">say</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
    <span class="n">say</span><span class="p">(</span><span class="n">Vector</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">direction</span><span class="p">(</span><span class="mf">0.0000001</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">a</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;a=&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s2">&quot;len(a)=&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;b=&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s2">&quot;length(b)=&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="p">(),</span> <span class="s2">&quot;len(b)=&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;matO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">O</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;matU</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">M</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;M</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;a=&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;M*a=&quot;</span><span class="p">,</span> <span class="n">M</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;M*X=&quot;</span><span class="p">,</span> <span class="n">M</span> <span class="o">*</span> <span class="n">Vector</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

    <span class="n">say</span><span class="p">(</span><span class="n">d2s</span><span class="p">(</span><span class="n">dms</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.006</span><span class="p">)))</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]])</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;M=</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;det(M)=&quot;</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">det</span><span class="p">())</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">eigenvalues</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Eigenvalues=&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Eigenvectors=</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;uT * diag(v) * u=</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span><span class="p">()</span> <span class="o">*</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Permutations of &#39;love&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">xpermutations</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]):</span>
        <span class="n">say</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Combinations of 2 letters from &#39;love&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xcombinations</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">say</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Unique Combinations of 2 letters from &#39;love&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">xuniqueCombinations</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">say</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uc</span><span class="p">))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Selections of 2 letters from &#39;love&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">xselections</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">say</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">xpermutations</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">))))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="n">say</span><span class="p">(</span><span class="s2">&quot;cubic(x^3-3x^2-10x+24=0)=&quot;</span><span class="p">,</span> <span class="n">cubic</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">))</span>

    <span class="n">say</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">):</span>
        <span class="n">say</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">int2roman</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymchelper 1.10.0+rev3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymchelper.flair.common.bmath</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Leszek Grzanka.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.0.
    </div>
  </body>
</html>