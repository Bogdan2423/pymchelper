
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sparse matrix data &#8212; pymchelper 1.11.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Inspect data" href="inspect_converter.html" />
    <link rel="prev" title="Gnuplot" href="gnuplot_converter.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">pymchelper</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="getting_started.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="user_guide.html">
  User’s Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="install.html">
  Installation Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="developer.html">
  Developer documentation
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="txt_converter.html">
   Plain text
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excel_converter.html">
   MS Excel file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="image_converter.html">
   Plots and images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gnuplot_converter.html">
   Gnuplot
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Sparse matrix data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inspect_converter.html">
   Inspect data
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example-usage">
   An example usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-reconstruction">
   Data reconstruction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#threshold-value">
   Threshold value
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="sparse-matrix-data">
<h1>Sparse matrix data<a class="headerlink" href="#sparse-matrix-data" title="Permalink to this headline">¶</a></h1>
<p>Sparse matrix format can greatly reduce size on disk in case most of the matrix is occupied with zeros.
For every input detector a single file with <code class="code bash docutils literal notranslate"><span class="pre">.npz</span></code> extension is written. It contains:</p>
<ul class="simple">
<li><p>shape of detector data: tuple of 3 numbers holding nx, ny and nz</p></li>
<li><p>tuple of 3 numpy arrays with X, Y and Z coordinates, pointing to non-zero data cells</p></li>
<li><p>plain, 1D numpy array with non-zero data values</p></li>
</ul>
<p>Such format is similar to a so-called COO-rdinate format for 2D sparse matrices.
Here it is used for any kind of data, with dimensionality between 0 and 3.</p>
<p>Output file is saved in uncompressed NPZ numpy data format,
for details see <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez.html</a></p>
<section id="an-example-usage">
<h2>An example usage<a class="headerlink" href="#an-example-usage" title="Permalink to this headline">¶</a></h2>
<p>Conversion is done using standard command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>convertmc sparse --many <span class="s2">&quot;*.bdo&quot;</span>
</pre></div>
</div>
<p>Assuming that we had “dose” detector output saved to <code class="code bash docutils literal notranslate"><span class="pre">dose0001.bdo</span></code>, <code class="code bash docutils literal notranslate"><span class="pre">dose0002.bdo</span></code> and <code class="code bash docutils literal notranslate"><span class="pre">dose0003.bdo</span></code>,
we should expect to get <code class="code bash docutils literal notranslate"><span class="pre">dose.npz</span></code> as an output file.</p>
</section>
<section id="data-reconstruction">
<h2>Data reconstruction<a class="headerlink" href="#data-reconstruction" title="Permalink to this headline">¶</a></h2>
<p>Sparse data can be extracted from NPZ file with following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># load contents of NPZ file:</span>
<span class="n">npzfile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>   <span class="c1"># plain 1-D numpy array</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span>  <span class="c1"># 3-elements tuple with array of coordinates</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="c1"># 3-element shape tuple</span>

<span class="c1"># reconstruct normal form of matrix from sparse data</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">dat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">result</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dat</span>
</pre></div>
</div>
</section>
<section id="threshold-value">
<h2>Threshold value<a class="headerlink" href="#threshold-value" title="Permalink to this headline">¶</a></h2>
<p>Additionally a threshold can be specified to discard noisy data.
In this case, all data cells with absolute value less or equal than threshold will be treated as zeros.
Please note that after reconstructing from sparse format we won’t get the original data,
as values lower than threshold will be overwritten with zeros.
An example usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>convertmc sparse --many <span class="s2">&quot;*.bdo&quot;</span> --threshold 1e-7
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="gnuplot_converter.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Gnuplot</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="inspect_converter.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inspect data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Leszek Grzanka.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>