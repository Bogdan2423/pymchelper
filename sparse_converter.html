
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sparse matrix data &#8212; pymchelper 1.10.0+rev3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Inspect data" href="inspect_converter.html" />
    <link rel="prev" title="Gnuplot" href="gnuplot_converter.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="inspect_converter.html" title="Inspect data"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gnuplot_converter.html" title="Gnuplot"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pymchelper 1.10.0+rev3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="user_guide.html" accesskey="U">User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sparse matrix data</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sparse-matrix-data">
<h1>Sparse matrix data<a class="headerlink" href="#sparse-matrix-data" title="Permalink to this headline">¶</a></h1>
<p>Sparse matrix format can greatly reduce size on disk in case most of the matrix is occupied with zeros.
For every input detector a single file with <code class="code bash docutils literal notranslate"><span class="pre">.npz</span></code> extension is written. It contains:</p>
<ul class="simple">
<li><p>shape of detector data: tuple of 3 numbers holding nx, ny and nz</p></li>
<li><p>tuple of 3 numpy arrays with X, Y and Z coordinates, pointing to non-zero data cells</p></li>
<li><p>plain, 1D numpy array with non-zero data values</p></li>
</ul>
<p>Such format is similar to a so-called COO-rdinate format for 2D sparse matrices.
Here it is used for any kind of data, with dimensionality between 0 and 3.</p>
<p>Output file is saved in uncompressed NPZ numpy data format,
for details see <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez.html</a></p>
<section id="an-example-usage">
<h2>An example usage<a class="headerlink" href="#an-example-usage" title="Permalink to this headline">¶</a></h2>
<p>Conversion is done using standard command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>convertmc sparse --many <span class="s2">&quot;*.bdo&quot;</span>
</pre></div>
</div>
<p>Assuming that we had “dose” detector output saved to <code class="code bash docutils literal notranslate"><span class="pre">dose0001.bdo</span></code>, <code class="code bash docutils literal notranslate"><span class="pre">dose0002.bdo</span></code> and <code class="code bash docutils literal notranslate"><span class="pre">dose0003.bdo</span></code>,
we should expect to get <code class="code bash docutils literal notranslate"><span class="pre">dose.npz</span></code> as an output file.</p>
</section>
<section id="data-reconstruction">
<h2>Data reconstruction<a class="headerlink" href="#data-reconstruction" title="Permalink to this headline">¶</a></h2>
<p>Sparse data can be extracted from NPZ file with following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># load contents of NPZ file:</span>
<span class="n">npzfile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>   <span class="c1"># plain 1-D numpy array</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span>  <span class="c1"># 3-elements tuple with array of coordinates</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">npzfile</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="c1"># 3-element shape tuple</span>

<span class="c1"># reconstruct normal form of matrix from sparse data</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">dat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">result</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dat</span>
</pre></div>
</div>
</section>
<section id="threshold-value">
<h2>Threshold value<a class="headerlink" href="#threshold-value" title="Permalink to this headline">¶</a></h2>
<p>Additionally a threshold can be specified to discard noisy data.
In this case, all data cells with absolute value less or equal than threshold will be treated as zeros.
Please note that after reconstructing from sparse format we won’t get the original data,
as values lower than threshold will be overwritten with zeros.
An example usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>convertmc sparse --many <span class="s2">&quot;*.bdo&quot;</span> --threshold 1e-7
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Sparse matrix data</a><ul>
<li><a class="reference internal" href="#an-example-usage">An example usage</a></li>
<li><a class="reference internal" href="#data-reconstruction">Data reconstruction</a></li>
<li><a class="reference internal" href="#threshold-value">Threshold value</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gnuplot_converter.html"
                        title="previous chapter">Gnuplot</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="inspect_converter.html"
                        title="next chapter">Inspect data</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sparse_converter.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="inspect_converter.html" title="Inspect data"
             >next</a> |</li>
        <li class="right" >
          <a href="gnuplot_converter.html" title="Gnuplot"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pymchelper 1.10.0+rev3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="user_guide.html" >User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sparse matrix data</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Leszek Grzanka.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.0.
    </div>
  </body>
</html>